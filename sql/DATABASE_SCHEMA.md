# ANSEL安泽酒店小程序数据库架构

## 数据库ER图概述

```
用户模块                   房间模块                   订单模块
+-------+  1:1   +-------+  M:1   +----------+  1:M   +-------+
| users |--------| members |-------| room_types |-------| rooms |
+-------+        +-------+        +----------+        +-------+
    |                |                 |                  |
    |                |                 |                  |
    |            1:M |             1:M |              M:1 |
    |         +----------------+    +----------------+    |
    |         | member_levels  |    | room_amenities |    |
    |         +----------------+    +----------------+    |
    |                |                     |              |
    |                |                     |              |
    |            1:M |                 M:M |              |
    |         +----------------+    +----------------+    |
    |         | member_privileges|   | room_type_amenities|
    |         +----------------+    +----------------+    |
    |                                                     |
  1:M|                                                  M:1|
+-------+  1:M   +-------+  M:1   +----------+        +-------+
| orders |-------| payments |      | coupons  |        | feedback |
+-------+        +-------+        +----------+        +-------+
    |                                   |
    |                                   |
  1:M|                               1:M|
+---------------+                +---------------+
| point_history |                | user_coupons  |
+---------------+                +---------------+

服务模块                   系统模块
+---------------+        +---------------+
| hotel_services |       | system_config |
+---------------+        +---------------+
        |                        |
        |                        |
      1:M|                     1:M|
+---------------+        +---------------+
| dining        |        | banners       |
+---------------+        +---------------+
        |                        |
        |                        |
      1:M|                     1:M|
+---------------+        +---------------+
| dining_images |        | chat_records  |
+---------------+        +---------------+
```

## 主要关系说明

### 用户与会员

- 每个用户可以拥有一个会员身份（1:1关系）
- 每个会员属于一个会员等级（M:1关系）
- 每个会员等级可以有多个会员特权（1:M关系）

### 房间与房型

- 每个房型可以有多个具体房间（1:M关系）
- 每个房型可以有多个图片（1:M关系）
- 房型和设施是多对多关系，通过`room_type_amenities`关联表实现

### 订单与支付

- 一个用户可以有多个订单（1:M关系）
- 一个订单对应一个房型和一个具体房间（M:1关系）
- 一个订单可以有多个支付记录（1:M关系）
- 一个订单可以使用一个优惠券（M:1关系）
- 订单和积分历史是一对多关系（1:M关系）

### 优惠券

- 一个优惠券可以被多个用户领取（1:M关系）
- 用户和优惠券是多对多关系，通过`user_coupons`关联表实现

### 酒店服务

- 酒店有多种服务类型（1:M关系）
- 酒店有多个餐厅（1:M关系）
- 每个餐厅可以有多张图片（1:M关系）

### 系统配置

- 系统有多个配置项（1:M关系）
- 系统有多个轮播图（1:M关系）
- 用户可以有多条聊天记录（1:M关系）

## 数据流说明

1. **用户下单流程**：
   - 用户（`users`）→ 选择房型（`room_types`）→ 创建订单（`orders`）→ 支付（`payments`）→ 分配房间（`rooms`）→ 积分变更（`point_history`）
   
2. **会员升级流程**：
   - 用户积分增加（`point_history`）→ 会员等级提升（`members`, `member_levels`）→ 获得新特权（`member_privileges`）

3. **优惠券使用流程**：
   - 系统生成优惠券（`coupons`）→ 用户领取（`user_coupons`）→ 下单使用（`orders`）→ 优惠券状态变更（`user_coupons`）

## 索引策略

主要表均设置了合适的索引以提高查询效率：

- 用户ID、手机号、会员ID等常用查询字段
- 订单状态、创建时间等常用筛选字段
- 房型价格、评分等常用排序字段
- 外键字段（如user_id, room_type_id等）

## 数据一致性策略

数据库使用了外键约束确保数据一致性：

- 当用户被删除时，级联删除相关会员信息
- 当房型被删除时，级联删除相关图片
- 其他关键关联采用了外键约束，防止孤立数据

## 存储优化

- 对于大文本内容使用TEXT类型
- 对于状态、类型等有限值使用TINYINT类型
- 对于价格等金额使用DECIMAL类型确保精确计算
- 对于创建时间、更新时间等使用默认值和自动更新